- type: entity
  parent: BaseItem
  id: IVBag
  name: iv bag
  description: Used to hold blood or other fluids to administer intravenously to a patient.
  components:
  - type: SolutionContainerManager
    solutions:
      beaker:
        maxVol: 400
  - type: Sprite
    sprite: _Offbrand/iv_bag.rsi
    layers:
    - state: base
    - state: fill-1
      map: [ "enum.SolutionContainerLayers.Fill" ]
      visible: false
    - state: label
  - type: Item
    size: Large
  - type: RefillableSolution
    solution: beaker
  - type: ExaminableSolution
    solution: beaker
    exactVolume: true
  - type: DrawableSolution
    solution: beaker
  - type: InjectableSolution
    solution: beaker
  - type: SolutionItemStatus
    solution: beaker
  - type: Appearance
  - type: SolutionContainerVisuals
    maxFillLevels: 5
    fillBaseName: fill-
  - type: StaticPrice
    price: 60
  - type: Damageable
    damageContainer: Inorganic
  - type: Destructible
    thresholds:
    - trigger:
        !type:DamageTrigger
        damage: 200
      behaviors:
        - !type:DoActsBehavior
          acts: [ "Destruction" ]
    - trigger:
        !type:DamageTrigger
        damage: 20
      behaviors:
      - !type:PlaySoundBehavior
        sound:
          collection: MetalBreak
          params:
            volume: -4
      - !type:SpillBehavior { }
      - !type:SpawnEntitiesBehavior
        spawn:
          SheetPlastic1:
            min: 0
            max: 1
        transferForensics: true
      - !type:DoActsBehavior
        acts: [ "Destruction" ]
  - type: Label
  - type: DnaSubstanceTrace
  - type: Tag
    tags:
    - IVBag
  - type: SolutionAppearanceRelay
    solution: beaker
    whitelist:
      tags:
      - IVStand

- type: entity
  id: IVStand
  name: iv stand
  description: Holds IV bags and allows their contents to be administered intravenously to patients.
  components:
  - type: Animateable
  - type: Clickable
  - type: InteractionOutline
  - type: Physics
    bodyType: Dynamic
  - type: MovedByPressure
  - type: Fixtures
    fixtures:
      fix1:
        shape:
          !type:PhysShapeCircle
          radius: 0.1
        density: 8000
        restitution: 0.0
        mask:
        - MachineMask
        layer:
        - MidImpassable
        - LowImpassable
        - BulletImpassable
  - type: Sprite
    sprite: _Offbrand/iv_stand.rsi
    layers:
    - state: base
    - state: bag
      map: ["bag"]
      visible: false
    - state: hooked
      map: ["hooked"]
      visible: false
    - state: fill-1
      map: [ "enum.SolutionContainerLayers.Fill" ]
      visible: false
    drawdepth: Mobs
    noRot: true
  - type: Pullable
  - type: Damageable
    damageContainer: Inorganic
    damageModifierSet: Metallic
  - type: Anchorable
  - type: Rotatable
  - type: Destructible
    thresholds:
    - trigger:
        !type:DamageTrigger
        damage: 100
      behaviors:
        - !type:DoActsBehavior
          acts: [ "Destruction" ]
    - trigger:
        !type:DamageTrigger
        damage: 50
      behaviors:
      - !type:DoActsBehavior
        acts: ["Destruction"]
      - !type:PlaySoundBehavior
        sound:
          collection: MetalBreak
  - type: ItemSlots
    slots:
      iv_bag_slot:
        whitelist:
          tags:
          - IVBag
  - type: ContainerContainer
    containers:
      iv_bag_slot: !type:ContainerSlot
  - type: Appearance
  - type: GenericVisualizer
    visuals:
      enum.SolutionAppearanceRelayedVisuals.HasRelay:
        enum.SolutionContainerLayers.Fill:
          True: { visible: true }
          False: { visible: false }
        bag:
          True: { visible: true }
          False: { visible: false }
      enum.IVSourceVisuals.HasTarget:
        hooked:
          True: { visible: true }
          False: { visible: false }
  - type: SolutionContainerVisuals
    maxFillLevels: 4
    fillBaseName: fill-
  - type: Tag
    tags:
    - IVStand
  - type: IVSource
  - type: Construction
    graph: IVStand
    node: ivstand
    containers:
    - iv_bag_slot

- type: construction
  id: IVStand
  graph: IVStand
  startNode: start
  targetNode: ivstand
  category: construction-category-machines
  objectType: Structure

- type: constructionGraph
  id: IVStand
  start: start
  graph:
  - node: start
    edges:
    - to: ivstand
      steps:
      - material: Steel
        amount: 5
        doAfter: 5
  - node: ivstand
    entity: IVStand
    edges:
    - to: start
      steps:
      - tool: Screwing
        doAfter: 5
      completed:
      - !type:SpawnPrototype
        prototype: SheetSteel1
        amount: 5
      - !type:EmptyAllContainers
      - !type:DeleteEntity

- type: entity
  parent: IVBag
  id: IVBagAmmoniaBlood
  suffix: anaerobic blood
  components:
  - type: Label
    currentLabel: reagent-name-ammonia-blood
  - type: SolutionContainerManager
    solutions:
      beaker:
        maxVol: 400
        reagents:
        - ReagentId: AmmoniaBlood
          Quantity: 400

- type: entity
  parent: IVBag
  id: IVBagBlood
  suffix: blood
  components:
  - type: Label
    currentLabel: reagent-name-blood
  - type: SolutionContainerManager
    solutions:
      beaker:
        maxVol: 400
        reagents:
        - ReagentId: Blood
          Quantity: 400

- type: entity
  parent: IVBag
  id: IVBagCopperBlood
  suffix: blue blood
  components:
  - type: Label
    currentLabel: reagent-name-hemocyanin-blood
  - type: SolutionContainerManager
    solutions:
      beaker:
        maxVol: 400
        reagents:
        - ReagentId: CopperBlood
          Quantity: 400

- type: entity
  parent: IVBag
  id: IVBagInsectBlood
  suffix: insect blood
  components:
  - type: Label
    currentLabel: reagent-name-insect-blood
  - type: SolutionContainerManager
    solutions:
      beaker:
        maxVol: 400
        reagents:
        - ReagentId: InsectBlood
          Quantity: 400

- type: entity
  parent: IVBag
  id: IVBagSap
  suffix: sap
  components:
  - type: Label
    currentLabel: reagent-name-sap
  - type: SolutionContainerManager
    solutions:
      beaker:
        maxVol: 400
        reagents:
        - ReagentId: Sap
          Quantity: 400

- type: entity
  parent: IVBag
  id: IVBagSlime
  suffix: slime
  components:
  - type: Label
    currentLabel: reagent-name-slime
  - type: SolutionContainerManager
    solutions:
      beaker:
        maxVol: 400
        reagents:
        - ReagentId: Slime
          Quantity: 400

- type: entityTable
  id: BloodBagFill
  table: !type:AllSelector
    children:
    - id: IVBag
    - id: IVBag
    - id: IVBagAmmoniaBlood
    - id: IVBagBlood
    - id: IVBagCopperBlood
    - id: IVBagInsectBlood
    - id: IVBagSap
    - id: IVBagSlime

- type: entity
  id: CrateFreezerIVBag
  parent: CrateFreezer
  name: iv bag freezer
  description: Contains pre-filled IV bags for use in re-blooding patients.
  components:
  - type: EntityTableContainerFill
    containers:
      entity_storage: !type:NestedSelector
        tableId: BloodBagFill
