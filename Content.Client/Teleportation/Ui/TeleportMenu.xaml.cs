using System.Numerics;
using Content.Shared.Teleportation.Components;
using Robust.Client.UserInterface.CustomControls;
using Robust.Client.UserInterface.XAML;
using Robust.Client.AutoGenerated;
using Robust.Client.UserInterface.Controls;

namespace Content.Client.Teleportation.Ui;

[GenerateTypedNameReferences]
public sealed partial class TeleportMenu : DefaultWindow
{
    public HashSet<TeleportPoint> _warps = new();

    public event EventHandler<string>? SearchTextUpdated;

    public event Action<NetEntity, string>? TeleportClicked;

    public TeleportMenu()
    {
        RobustXamlLoader.Load(this);
        IoCManager.InjectDependencies(this);

        // TODO: On Generated button down,
        SearchBar.OnTextChanged += _ => SearchTextUpdated?.Invoke(this, SearchBar.Text);
    }

    public void AddTeleportButtons()
    {
        foreach (var (name, teleportPoint) in _warps)
        {
            var currentButtonRef = new Button
            {
                Text = name,
                TextAlign = Label.AlignMode.Right,
                HorizontalAlignment = HAlignment.Center,
                VerticalAlignment = VAlignment.Center,
                SizeFlagsStretchRatio = 1,
                MinSize = new Vector2(340, 20),
                ClipText = true,
            };

            currentButtonRef.OnPressed += _ => TeleportClicked?.Invoke(teleportPoint, name);
            //currentButtonRef.Visible = ButtonIsVisible(currentButtonRef);

            TeleportButtonContainer.AddChild(currentButtonRef);
        }
    }
}
