using Robust.Client.AutoGenerated;
using Robust.Client.UserInterface.Controls;
using Robust.Client.UserInterface.XAML;

namespace Content.Client.Instruments.UI;

[GenerateTypedNameReferences]
public sealed partial class BandMidiSource : InstrumentMidiSourceBase
{
    public event Action? RefreshBandRequest;
    public event Action<EntityUid>? JoinBandRequest;

    public override string ButtonName => Loc.GetString("instruments-component-menu-band-midi-source-button");

    public BandMidiSource()
    {
        RobustXamlLoader.Load(this);

        RefreshButton.OnPressed += OnRefreshPressed;
        BandList.OnItemSelected += OnBandItemSelected;
    }

    private void OnRefreshPressed(BaseButton.ButtonEventArgs _)
    {
        RefreshBandRequest?.Invoke();
    }

    private void OnBandItemSelected(ItemList.ItemListSelectedEventArgs args)
    {
        var instrumentEntity = (EntityUid)args.ItemList[args.ItemIndex].Metadata!;
        JoinBandRequest?.Invoke(instrumentEntity);
    }

    public void Populate(IEnumerable<(EntityUid, string)> entities)
    {
        BandList.Clear();
        foreach (var tuple in entities)
        {
            BandList.AddItem(tuple.Item2, null, true, tuple.Item1);
        }
    }
}
