using Robust.Client.AutoGenerated;
using Robust.Client.UserInterface;
using Robust.Client.UserInterface.Controls;
using Robust.Client.UserInterface.XAML;

namespace Content.Client.Instruments.UI;

[GenerateTypedNameReferences]
public sealed partial class ChannelsControl : Control
{
    public event Action<int, bool>? SwitchFilteredChannel;
    public event Action? ChannelsUpdateRequest;

    public bool DisplayTrackNames => DisplayTrackNamesButton.Pressed;

    public ChannelsControl()
    {
        RobustXamlLoader.Load(this);
        IoCManager.InjectDependencies(this);

        ChannelList.OnItemSelected += OnItemSelected;
        ChannelList.OnItemDeselected += OnItemDeselected;
        AllButton.OnPressed += OnAllPressed;
        ClearButton.OnPressed += OnClearPressed;
        DisplayTrackNamesButton.OnPressed += OnDisplayTrackNamesPressed;
    }

    private void OnDisplayTrackNamesPressed(BaseButton.ButtonEventArgs obj)
    {
        ChannelsUpdateRequest?.Invoke();
    }

    private void OnItemSelected(ItemList.ItemListSelectedEventArgs args)
    {
        SwitchFilteredChannel?.Invoke((int)ChannelList[args.ItemIndex].Metadata!, false);
    }

    private void OnItemDeselected(ItemList.ItemListDeselectedEventArgs args)
    {
        SwitchFilteredChannel?.Invoke((int)ChannelList[args.ItemIndex].Metadata!, true);
    }

    private void OnAllPressed(BaseButton.ButtonEventArgs obj)
    {
        foreach (var item in ChannelList)
        {
            // TODO: Make this efficient jfc
            item.Selected = true;
        }
    }

    private void OnClearPressed(BaseButton.ButtonEventArgs obj)
    {
        foreach (var item in ChannelList)
        {
            // TODO: Make this efficient jfc
            item.Selected = false;
        }
    }

    public void SetChannels(IEnumerable<(int, string, bool)> channels)
    {
        ChannelList.Clear();
        foreach (var channel in channels)
        {
            var item = ChannelList.AddItem(channel.Item2, null, true, channel.Item1);
            item.Selected = channel.Item3;
        }
    }
}
