using Content.Shared.Arcade;
using Robust.Client.AutoGenerated;
using Robust.Client.UserInterface.CustomControls;
using Robust.Client.UserInterface.XAML;


namespace Content.Client.Arcade;

[GenerateTypedNameReferences]
public sealed partial class SpaceVillainArcadeMenu : DefaultWindow
{
    public event Action<SharedSpaceVillainArcadeComponent.PlayerAction>? OnPlayerAction;

    public SpaceVillainArcadeMenu()
    {
        RobustXamlLoader.Load(this);
        AttackButton.OnPressed += _ => OnPlayerAction?.Invoke(SharedSpaceVillainArcadeComponent.PlayerAction.Attack);
        HealButton.OnPressed += _ => OnPlayerAction?.Invoke(SharedSpaceVillainArcadeComponent.PlayerAction.Heal);
        RechargeButton.OnPressed += _ => OnPlayerAction?.Invoke(SharedSpaceVillainArcadeComponent.PlayerAction.Recharge);
        NewGameButton.OnPressed += _ => OnPlayerAction?.Invoke(SharedSpaceVillainArcadeComponent.PlayerAction.NewGame);
    }

    private void UpdateMetadata(SharedSpaceVillainArcadeComponent.SpaceVillainArcadeMetaDataUpdateMessage message)
    {
        Title = message.GameTitle;
        EnemyNameLabel.Text = message.EnemyName;

        AttackButton.Disabled = message.ButtonsDisabled;
        HealButton.Disabled = message.ButtonsDisabled;
        RechargeButton.Disabled = message.ButtonsDisabled;
    }

    public void UpdateInfo(SharedSpaceVillainArcadeComponent.SpaceVillainArcadeDataUpdateMessage message)
    {
        if (message is SharedSpaceVillainArcadeComponent.SpaceVillainArcadeMetaDataUpdateMessage metaMessage)
            UpdateMetadata(metaMessage);

        PlayerHpLabel.Text = Loc.GetString("spacevillain-menu-label-health", ("amount", message.PlayerHP));
        PlayerMpLabel.Text = Loc.GetString("spacevillain-menu-label-magic", ("amount", message.PlayerMP));
        EnemyHpLabel.Text = Loc.GetString("spacevillain-menu-label-health", ("amount", message.EnemyHP));
        EnemyMpLabel.Text = Loc.GetString("spacevillain-menu-label-magic", ("amount", message.EnemyMP));
        PlayerActionLabel.Text = message.PlayerActionMessage;
        EnemyActionLabel.Text = message.EnemyActionMessage;
    }
}