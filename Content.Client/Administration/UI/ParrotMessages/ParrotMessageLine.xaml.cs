using Content.Client.Commands;

using Content.Shared.Administration.ParrotMessages;
using Robust.Client.AutoGenerated;
using Robust.Client.UserInterface.Controls;
using Robust.Client.UserInterface.XAML;
using Robust.Shared.Console;

namespace Content.Client.Administration.UI.ParrotMessages;

[GenerateTypedNameReferences]
public sealed partial class ParrotMessageLine : BoxContainer
{
    private readonly IConsoleHost _console;

    public ParrotMessageLine()
    {
        RobustXamlLoader.Load(this);

        IoCManager.Resolve(ref _console);
    }

    public void SetMessage(ExtendedPlayerMessage memory)
    {
        ParrotMessageText.Text = memory.MessageText;

        ParrotMessagePlayerButton.Text = memory.SourcePlayerUserName;

        var command = new OpenAHelpCommand();
        ParrotMessagePlayerButton.OnPressed += (_) =>
        {
            command.Execute(_console.LocalShell, memory.SourcePlayerGuid.ToString(), []);
        };
    }
}
