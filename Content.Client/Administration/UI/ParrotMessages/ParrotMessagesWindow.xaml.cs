using Content.Client.UserInterface.Controls;
using Content.Shared.Administration.ParrotMessages;
using Robust.Client.AutoGenerated;
using Robust.Client.UserInterface.XAML;

namespace Content.Client.Administration.UI.ParrotMessages;

[GenerateTypedNameReferences]
public sealed partial class ParrotMessagesWindow : FancyWindow
{
    public ParrotMessagesWindow()
    {
        RobustXamlLoader.Load(this);
    }

    public ParrotMessageList? GetActiveList()
    {
        var currentActiveTab = MessageTabContainer.CurrentTab;
        var currentActiveChild = MessageTabContainer.GetChild(currentActiveTab);

        if (currentActiveChild is not ParrotMessageList { } parrotMessageList)
            return null;

        return parrotMessageList;
    }

    public void UpdateMessages(ParrotMessagesEui eui, ParrotMessagesEuiState parrotState)
    {
        var activeList = GetActiveList();

        activeList?.UpdateMessages(eui, parrotState.Messages);
    }

    public void MarkInactiveListsDirty()
    {
        for (var i = 0; i < MessageTabContainer.ChildCount; i++)
        {
            if (i == MessageTabContainer.CurrentTab)
                continue;

            var child = MessageTabContainer.GetChild(i);
            if (child is not ParrotMessageList { } parrotMessageList)
                continue;

            parrotMessageList.Dirty = true;
        }
    }
}
