using Lidgren.Network;
using Robust.Shared.Network;
using Robust.Shared.Serialization;

namespace Content.Shared.BugReport;

/// <summary>
///     This message will be generated by clients and sent directly to the server. This message SHOULD NOT be directly
///     listened for as malicious clients could send whatever they want. Listen to the event from the bug report manager!
/// </summary>
/// <remarks>
///     This is sent FROM the client TO the sever.
/// </remarks>
public sealed class BugReportMessage : NetMessage
{
    public override MsgGroups MsgGroup => MsgGroups.EntityEvent;

    public PlayerBugReportInformation ReportInformation = new();

    public override void ReadFromBuffer(NetIncomingMessage buffer, IRobustSerializer serializer)
    {
        ReportInformation.BugReportTitle = buffer.ReadString();
        ReportInformation.BugReportDescription = buffer.ReadString();
    }

    public override void WriteToBuffer(NetOutgoingMessage buffer, IRobustSerializer serializer)
    {
        buffer.Write(ReportInformation.BugReportTitle);
        buffer.Write(ReportInformation.BugReportDescription);
    }

    public override NetDeliveryMethod DeliveryMethod => NetDeliveryMethod.ReliableUnordered;
}

/// <summary>
///     Stores user specified information from a bug report.
/// </summary>
/// <remarks>
///      Clients can put whatever they want here so be careful!
/// </remarks>
public sealed class PlayerBugReportInformation
{
    public string BugReportTitle = string.Empty;
    public string BugReportDescription = string.Empty;
}
